<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bourse de l'√©quipe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 10px;
        }
        h1, h2 {
            color: #444;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f8f8;
        }
        form {
            margin-bottom: 20px;
        }
        input[type="text"], input[type="number"] {
            padding: 6px;
            margin-right: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 60px; /* Largeur r√©duite */
        }
        button {
            padding: 6px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        button:hover {
            background-color: #218838;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header img {
            max-width: 100%; /* L'image s'adapte √† la largeur de l'√©cran */
            height: auto;
            border-radius: 8px;
        }
        .total-money {
            display: flex;
            flex-wrap: wrap; /* Permet aux √©l√©ments de passer √† la ligne sur les petits √©crans */
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 8px;
        }
        .total-money div {
            flex: 1 1 100%; /* Les √©l√©ments prennent toute la largeur sur les petits √©crans */
            margin-bottom: 10px;
        }
        .total-money label {
            font-weight: bold;
            display: block; /* Le label est sur une ligne s√©par√©e */
        }
        .total-money input {
            width: 100%; /* Les champs prennent toute la largeur disponible */
        }
        .money-controls {
            display: flex;
            align-items: center;
            gap: 5px; /* Espacement entre les √©l√©ments */
        }
        .money-controls button {
            margin: 0;
            padding: 5px 8px;
            background-color: #007bff;
        }
        .money-controls button:hover {
            background-color: #0056b3;
        }
        .delete-button {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 5px 8px;
            font-size: 0.8em;
        }
        .delete-button:hover {
            background-color: #c82333;
        }
        .editable-name, .editable-money {
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 4px;
            background-color: #f8f8f8;
            width: 60px; /* Largeur r√©duite */
        }
        .add-form {
            display: flex;
            flex-wrap: wrap; /* Les √©l√©ments passent √† la ligne sur les petits √©crans */
            gap: 5px;
            margin-top: 10px;
        }
        .add-form input {
            width: 60px; /* Largeur r√©duite */
        }
        .add-form button {
            width: 100%; /* Le bouton prend toute la largeur */
        }
        .player-row {
            display: flex;
            flex-direction: column;
        }

        /* Styles sp√©cifiques pour les petits √©crans */
        @media (max-width: 600px) {
            .total-money div {
                flex: 1 1 100%; /* Les √©l√©ments prennent toute la largeur */
            }
            .total-money input {
                width: 100%; /* Les champs prennent toute la largeur */
            }
            .money-controls {
                flex-direction: column; /* Les boutons sont empil√©s verticalement */
            }
            .editable-name, .editable-money {
                width: 100%; /* Les champs prennent toute la largeur */
            }
            .add-form input {
                width: 100%; /* Les champs prennent toute la largeur */
            }
            table, thead, tbody, th, td, tr {
                display: block; /* Convertir la table en bloc pour les petits √©crans */
            }
            th {
                position: absolute;
                top: -9999px;
                left: -9999px; /* Cacher les en-t√™tes de la table */
            }
            tr {
                border: 1px solid #ccc;
                margin-bottom: 10px; /* Espacement entre les lignes */
            }
            td {
                border: none;
                position: relative;
                padding-left: 50%; /* D√©calage pour les labels */
            }
            td:before {
                position: absolute;
                top: 6px;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                content: attr(data-label); /* Afficher les labels */
                font-weight: bold;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bourse de l'√©quipe üêâ</h1>
            <img src="{{ url_for('static', filename='dnd.jpg') }}" alt="D&D Image">
        </div>

        <!-- Section pour le total d'or, d'argent et de cuivre -->
        <div class="total-money">
            <div>
                <label for="total_gold">Or total :</label>
                <input type="number" id="total_gold" name="total_gold" min="0" required onchange="updateTotal('gold')" value="{{ totals.gold }}">
                <div class="money-controls">
                    <input type="number" id="add_gold" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('gold')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('gold')">D√©penser</button>
                </div>
            </div>
            <div>
                <label for="total_silver">Argent total :</label>
                <input type="number" id="total_silver" name="total_silver" min="0" required onchange="updateTotal('silver')" value="{{ totals.silver }}">
                <div class="money-controls">
                    <input type="number" id="add_silver" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('silver')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('silver')">D√©penser</button>
                </div>
            </div>
            <div>
                <label for="total_copper">Cuivre total :</label>
                <input type="number" id="total_copper" name="total_copper" min="0" required onchange="updateTotal('copper')" value="{{ totals.copper }}">
                <div class="money-controls">
                    <input type="number" id="add_copper" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('copper')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('copper')">D√©penser</button>
                </div>
            </div>
            <button type="button" onclick="shareMoney()">Partager üîÑ</button>
        </div>

        <!-- Liste des joueurs -->
        <table id="players-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Nom</th>
                    <th>Or</th>
                    <th>Argent</th>
                    <th>Cuivre</th>
                </tr>
            </thead>
            <tbody>
                {% for player, money in players.items() %}
                <tr id="player-{{ player }}">
                    <td data-label="Actions">
                        <button class="delete-button" onclick="deletePlayer('{{ player }}')">üóëÔ∏è</button>
                    </td>
                    <td data-label="Nom">
                        <input type="text" class="editable-name" id="name-{{ player }}" value="{{ player }}" onchange="updateName('{{ player }}')">
                    </td>
                    <td data-label="Or">
                        <input type="number" class="editable-money" id="{{ player }}-gold" value="{{ money['gold'] }}" onchange="updateMoneyDirect('{{ player }}', 'gold')">
                    </td>
                    <td data-label="Argent">
                        <input type="number" class="editable-money" id="{{ player }}-silver" value="{{ money['silver'] }}" onchange="updateMoneyDirect('{{ player }}', 'silver')">
                    </td>
                    <td data-label="Cuivre">
                        <input type="number" class="editable-money" id="{{ player }}-copper" value="{{ money['copper'] }}" onchange="updateMoneyDirect('{{ player }}', 'copper')">
                    </td>
                </tr>
                <tr class="add-row">
                    <td colspan="2" data-label="Actions"></td>
                    <td data-label="Ajouter Or">
                        <input type="number" id="add-gold-{{ player }}" placeholder="" min="0">
                    </td>
                    <td data-label="Ajouter Argent">
                        <input type="number" id="add-silver-{{ player }}" placeholder="" min="0">
                    </td>
                    <td data-label="Ajouter Cuivre">
                        <input type="number" id="add-copper-{{ player }}" placeholder="" min="0">
                    </td>
                    <td data-label="Actions">
                        <button type="button" onclick="addMoney('{{ player }}')">Ajouter</button>
                        <button type="button" onclick="spendMoney('{{ player }}')">D√©penser üí∏</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Ajouter un joueur -->
        <h2>Ajouter un joueur</h2>
        <form id="add-player-form" onsubmit="event.preventDefault(); addPlayer();">
            <label for="player_name">Nom du joueur :</label>
            <input type="text" id="player_name" name="player_name" required>
            <button type="submit">ü™Ñ Ajouter</button>
        </form>
    </div>

    <script>
        // Fonction pour ajouter un joueur
        async function addPlayer() {
            const playerName = document.getElementById('player_name').value;
            const response = await fetch('/add_player', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${playerName}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour ajouter de la valeur aux totaux
        async function addToTotal(currency) {
            const amount = parseInt(document.getElementById(`add_${currency}`).value) || 0;
            const response = await fetch('/add_to_total', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour d√©penser de la valeur des totaux
        async function spendFromTotal(currency) {
            const amount = parseInt(document.getElementById(`add_${currency}`).value) || 0;
            const response = await fetch('/spend_from_total', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour partager l'argent
        async function shareMoney() {
            const totalGold = parseInt(document.getElementById('total_gold').value) || 0;
            const totalSilver = parseInt(document.getElementById('total_silver').value) || 0;
            const totalCopper = parseInt(document.getElementById('total_copper').value) || 0;

            const response = await fetch('/split_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `total_gold=${totalGold}&total_silver=${totalSilver}&total_copper=${totalCopper}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour ajouter de l'argent √† un joueur
        async function addMoney(player) {
            const gold = parseInt(document.getElementById(`add-gold-${player}`).value) || 0;
            const silver = parseInt(document.getElementById(`add-silver-${player}`).value) || 0;
            const copper = parseInt(document.getElementById(`add-copper-${player}`).value) || 0;

            const response = await fetch('/add_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}&gold=${gold}&silver=${silver}&copper=${copper}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour d√©penser de l'argent d'un joueur
        async function spendMoney(player) {
            const gold = parseInt(document.getElementById(`add-gold-${player}`).value) || 0;
            const silver = parseInt(document.getElementById(`add-silver-${player}`).value) || 0;
            const copper = parseInt(document.getElementById(`add-copper-${player}`).value) || 0;

            const response = await fetch('/spend_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}&gold=${gold}&silver=${silver}&copper=${copper}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour supprimer un joueur
        async function deletePlayer(player) {
            const response = await fetch('/delete_player', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour mettre √† jour le nom d'un joueur
        async function updateName(oldName) {
            const newName = document.getElementById(`name-${oldName}`).value;
            const response = await fetch('/update_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `old_name=${oldName}&new_name=${newName}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour mettre √† jour l'argent directement
        async function updateMoneyDirect(player, currency) {
            const amount = parseInt(document.getElementById(`${player}-${currency}`).value) || 0;
            const response = await fetch('/update_money_direct', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}&currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour mettre √† jour les totaux
        async function updateTotal(currency) {
            const amount = parseInt(document.getElementById(`total_${currency}`).value) || 0;
            const response = await fetch('/update_total', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }
    </script>
</body>
</html>