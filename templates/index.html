<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bourse de l'√©quipe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 10px;
        }
        h1, h2 {
            color: #444;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .total-money {
            margin-bottom: 20px;
        }
        .total-money .currency-block {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .total-money label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .total-money input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .total-money .money-controls {
            display: flex;
            gap: 5px;
        }
        .total-money .money-controls button {
            flex: 1;
            padding: 6px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .total-money .money-controls button:hover {
            background-color: #0056b3;
        }
        .player-block {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .player-block .player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .player-block .player-header input {
            flex: 1;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }
        .player-block .player-header button {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
        }
        .player-block .player-header button:hover {
            background-color: #c82333;
        }
        .player-block .currency-row {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        .player-block .currency-row label {
            flex: 1;
            font-weight: bold;
        }
        .player-block .currency-row input {
            width: 60px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .player-block .currency-row .money-controls {
            display: flex;
            gap: 5px;
        }
        .player-block .currency-row .money-controls button {
            padding: 6px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .player-block .currency-row .money-controls button:hover {
            background-color: #218838;
        }
        .add-player-form {
            margin-top: 20px;
        }
        .add-player-form input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .add-player-form button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-player-form button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bourse de l'√©quipe üêâ</h1>
            <img src="{{ url_for('static', filename='dnd.jpg') }}" alt="D&D Image">
        </div>

        <!-- Section pour le total d'or, d'argent et de cuivre -->
        <div class="total-money">
            <div class="currency-block">
                <label for="total_gold">Or total :</label>
                <input type="number" id="total_gold" name="total_gold" min="0" required onchange="updateTotal('gold')" value="{{ totals.gold }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add_gold" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('gold')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('gold')">D√©penser</button>
                </div>
            </div>
            <div class="currency-block">
                <label for="total_silver">Argent total :</label>
                <input type="number" id="total_silver" name="total_silver" min="0" required onchange="updateTotal('silver')" value="{{ totals.silver }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add_silver" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('silver')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('silver')">D√©penser</button>
                </div>
            </div>
            <div class="currency-block">
                <label for="total_copper">Cuivre total :</label>
                <input type="number" id="total_copper" name="total_copper" min="0" required onchange="updateTotal('copper')" value="{{ totals.copper }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add_copper" placeholder="" min="0">
                    <button type="button" onclick="addToTotal('copper')">Ajouter</button>
                    <button type="button" onclick="spendFromTotal('copper')">D√©penser</button>
                </div>
            </div>
            <button type="button" onclick="shareMoney()" style="width: 100%; padding: 10px; margin-top: 10px;">Partager üîÑ</button>
        </div>

        <!-- Liste des joueurs -->
        {% for player, money in players.items() %}
        <div class="player-block">
            <div class="player-header">
                <input type="text" class="editable-name" id="name-{{ player }}" value="{{ player }}" onchange="updateName('{{ player }}')">
                <button class="delete-button" onclick="deletePlayer('{{ player }}')">üóëÔ∏è</button>
            </div>
            <div class="currency-row">
                <label>Or :</label>
                <input type="number" class="editable-money" id="{{ player }}-gold" value="{{ money['gold'] }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add-gold-{{ player }}" placeholder="" min="0">
                    <button type="button" onclick="addMoney('{{ player }}', 'gold')">Ajouter</button>
                    <button type="button" onclick="spendMoney('{{ player }}', 'gold')">D√©penser</button>
                </div>
            </div>
            <div class="currency-row">
                <label>Argent :</label>
                <input type="number" class="editable-money" id="{{ player }}-silver" value="{{ money['silver'] }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add-silver-{{ player }}" placeholder="" min="0">
                    <button type="button" onclick="addMoney('{{ player }}', 'silver')">Ajouter</button>
                    <button type="button" onclick="spendMoney('{{ player }}', 'silver')">D√©penser</button>
                </div>
            </div>
            <div class="currency-row">
                <label>Cuivre :</label>
                <input type="number" class="editable-money" id="{{ player }}-copper" value="{{ money['copper'] }}" readonly>
                <div class="money-controls">
                    <input type="number" id="add-copper-{{ player }}" placeholder="" min="0">
                    <button type="button" onclick="addMoney('{{ player }}', 'copper')">Ajouter</button>
                    <button type="button" onclick="spendMoney('{{ player }}', 'copper')">D√©penser</button>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Ajouter un joueur -->
        <h2>Ajouter un joueur</h2>
        <form class="add-player-form" id="add-player-form" onsubmit="event.preventDefault(); addPlayer();">
            <input type="text" id="player_name" name="player_name" placeholder="Nom du joueur" required>
            <button type="submit">ü™Ñ Ajouter</button>
        </form>
    </div>

    <script>
        // Fonction pour ajouter un joueur
        async function addPlayer() {
            const playerName = document.getElementById('player_name').value;
            const response = await fetch('/add_player', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${playerName}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour ajouter de la valeur aux totaux
        async function addToTotal(currency) {
            const amount = parseInt(document.getElementById(`add_${currency}`).value) || 0;
            const response = await fetch('/add_to_total', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour d√©penser de la valeur des totaux
        async function spendFromTotal(currency) {
            const amount = parseInt(document.getElementById(`add_${currency}`).value) || 0;
            const response = await fetch('/spend_from_total', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `currency=${currency}&amount=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour partager l'argent
        async function shareMoney() {
            const totalGold = parseInt(document.getElementById('total_gold').value) || 0;
            const totalSilver = parseInt(document.getElementById('total_silver').value) || 0;
            const totalCopper = parseInt(document.getElementById('total_copper').value) || 0;

            const response = await fetch('/split_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `total_gold=${totalGold}&total_silver=${totalSilver}&total_copper=${totalCopper}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour ajouter de l'argent √† un joueur
        async function addMoney(player, currency) {
            const amount = parseInt(document.getElementById(`add-${currency}-${player}`).value) || 0;
            const response = await fetch('/add_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}&${currency}=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour d√©penser de l'argent d'un joueur
        async function spendMoney(player, currency) {
            const amount = parseInt(document.getElementById(`add-${currency}-${player}`).value) || 0;
            const response = await fetch('/spend_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}&${currency}=${amount}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour supprimer un joueur
        async function deletePlayer(player) {
            const response = await fetch('/delete_player', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `player_name=${player}`,
            });

            if (response.ok) {
                location.reload();
            }
        }

        // Fonction pour mettre √† jour le nom d'un joueur
        async function updateName(oldName) {
            const newName = document.getElementById(`name-${oldName}`).value;
            const response = await fetch('/update_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `old_name=${oldName}&new_name=${newName}`,
            });

            if (response.ok) {
                location.reload();
            }
        }
    </script>
</body>
</html>